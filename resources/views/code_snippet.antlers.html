{{ layout = 'layout' }}

<!-- Radical Animated Background -->
<div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute top-10 left-5 w-20 h-20 bg-accent opacity-10 transform rotate-45 animate-float bg-element"></div>
    <div class="absolute top-32 right-10 w-16 h-16 border-2 border-accent opacity-20 animate-float-delayed bg-element"></div>
    <div class="absolute bottom-32 left-1/4 w-12 h-12 bg-black opacity-30 transform rotate-12 animate-spin-slow bg-element"></div>
    <div class="absolute top-1/2 right-1/4 w-8 h-32 bg-accent opacity-15 transform -rotate-45 animate-float bg-element"></div>
    <div class="absolute bottom-10 right-5 w-18 h-18 border-2 border-black opacity-25 transform rotate-45 animate-pulse bg-element"></div>
    <div class="absolute top-1/4 left-1/2 w-6 h-6 bg-accent opacity-40 transform rotate-45 animate-bounce bg-element"></div>
</div>

<div class="relative z-10 max-w-7xl mx-auto">
    <!-- Terminal Header with Navigation -->
    <header class="mb-12 reveal-on-scroll">
        <div class="terminal-window bg-black border-4 border-accent shadow-sharp transform -rotate-1">
            <div class="terminal-title-bar bg-gray-800 p-3 flex items-center justify-between">
                <div class="flex space-x-2">
                    <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                    <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                </div>
                <span class="text-white font-mono text-sm">~/snippets/{{ slug }} $</span>
            </div>
            <div class="p-6 font-mono">
                <div class="text-green-400 mb-2">
                    <span class="text-accent">arym@portfolio</span>:<span class="text-blue-400">~/snippets</span>$ cat {{ slug }}.{{ language }}
                </div>
                <div class="text-gray-400 text-sm mb-4">
                    <a href="/snippets" class="text-cyan-400 hover:text-accent transition-colors">‚Üê back to snippets</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
        <!-- Code Content (2/3 width) -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Title Section -->
            <div class="card-sharp bg-white border-4 border-black shadow-sharp transform hover:rotate-0 transition-all duration-300 reveal-on-scroll rotate-1">
                <div class="absolute -top-3 -right-3 px-4 py-2 bg-accent text-white font-black text-xs transform rotate-12 shadow-sharp">
                    {{ language | upper }}
                </div>
                <div class="absolute -bottom-2 -left-2 w-6 h-6 bg-accent transform rotate-45"></div>
                
                <div class="p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="px-3 py-1 bg-gray-800 text-white font-mono text-sm rounded">{{ difficulty | upper }}</span>
                        {{ if is_featured }}
                        <span class="px-3 py-1 bg-accent text-white font-mono text-sm rounded animate-pulse">FEATURED</span>
                        {{ /if }}
                        <span class="text-gray-400 font-mono text-sm">{{ date format="F j, Y" }}</span>
                    </div>
                    
                    <h1 class="text-4xl md:text-6xl font-black mb-6 geometric-accent glitch-effect">{{ title }}</h1>
                    
                    {{ if description }}
                    <div class="prose prose-lg max-w-none mb-8">
                        <p class="text-gray-700 text-xl leading-relaxed">{{ description }}</p>
                    </div>
                    {{ /if }}
                    
                    <!-- Tags -->
                    {{ if use_cases }}
                    <div class="flex flex-wrap gap-2 mb-6">
                        {{ use_cases }}
                        <span class="px-3 py-1 bg-gray-100 text-gray-700 font-mono text-xs rounded-full border border-gray-300">#{{ value }}</span>
                        {{ /use_cases }}
                    </div>
                    {{ /if }}
                </div>
            </div>

            <!-- Main Code Block -->
            <div class="card-sharp bg-black border-4 border-accent shadow-sharp transform hover:rotate-0 transition-all duration-300 reveal-on-scroll -rotate-1">
                <div class="absolute -top-4 -left-4 px-6 py-3 bg-black text-accent font-black text-lg transform -rotate-12 shadow-sharp border-2 border-accent">
                    CODE_EXECUTE
                </div>
                
                <!-- Terminal-style header -->
                <div class="bg-gray-800 p-4 border-b-2 border-accent flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <span class="text-green-400 font-mono">üìÑ {{ title | slugify }}.{{ language }}</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <button id="copy-code" class="text-gray-400 hover:text-accent transition-colors font-mono text-sm">
                            [COPY]
                        </button>
                        {{ if external_link }}
                        <a href="{{ external_link }}" target="_blank" class="text-blue-400 hover:text-accent transition-colors font-mono text-sm">
                            [EXTERNAL]
                        </a>
                        {{ /if }}
                    </div>
                </div>
                
                <!-- Code content -->
                <div class="relative overflow-hidden">
                    <pre class="p-6 overflow-x-auto text-green-400 font-mono text-sm leading-relaxed" id="code-content"><code>{{ code | strip_tags }}</code></pre>
                    
                    <!-- Scrolling indicator -->
                    <div class="absolute top-4 right-4 text-accent opacity-50 font-mono text-xs animate-pulse">
                        &gt;&gt; SCROLL_TO_VIEW_MORE
                    </div>
                </div>
                
                <!-- Terminal prompt at bottom -->
                <div class="bg-gray-800 p-4 border-t-2 border-accent">
                    <div class="text-green-400 font-mono text-sm">
                        <span class="text-accent">$</span> echo "Code execution completed successfully"
                        <div class="text-gray-400 mt-1">‚Üí Lines: {{ content | strip_tags | split:'\n' | count }}</div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 reveal-on-scroll">
                <div class="bg-black border-2 border-gray-600 text-white font-mono p-4 text-center transform hover:scale-105 transition-all">
                    <div class="text-accent text-2xl font-bold">{{ code | strip_tags | split:'\n' | count }}</div>
                    <div class="text-gray-400 text-xs">LINES_OF_CODE</div>
                </div>
                <div class="bg-black border-2 border-gray-600 text-white font-mono p-4 text-center transform hover:scale-105 transition-all">
                    <div class="text-green-400 text-2xl font-bold">{{ difficulty | upper }}</div>
                    <div class="text-gray-400 text-xs">COMPLEXITY_LEVEL</div>
                </div>
                <div class="bg-black border-2 border-gray-600 text-white font-mono p-4 text-center transform hover:scale-105 transition-all">
                    <div class="text-cyan-400 text-2xl font-bold">{{ programming_languages | count }}</div>
                    <div class="text-gray-400 text-xs">TECH_STACK</div>
                </div>
            </div>
        </div>

        <!-- Sidebar (1/3 width) -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Quick Info Panel -->
            <div class="card-sharp bg-black border-2 border-accent text-white shadow-sharp transform hover:rotate-0 transition-all duration-300 reveal-on-scroll rotate-2">
                <div class="absolute -top-2 -right-2 w-4 h-4 bg-accent transform rotate-45"></div>
                
                <div class="p-6 font-mono">
                    <h3 class="text-accent font-black mb-4 text-lg">SYSTEM_INFO</h3>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-400">PRIMARY_LANG:</span>
                            <span class="text-green-400">{{ language | upper }}</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-400">DIFFICULTY:</span>
                            <span class="text-yellow-400">{{ difficulty | upper }}</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-400">DATE_CREATED:</span>
                            <span class="text-cyan-400">{{ date format="Y.m.d" }}</span>
                        </div>
                        
                        {{ if programming_languages }}
                        <div class="border-t border-gray-600 pt-3 mt-3">
                            <div class="text-gray-400 mb-2">TECH_STACK:</div>
                            {{ programming_languages }}
                            <span class="inline-block px-2 py-1 bg-gray-700 text-cyan-400 text-xs rounded mb-1 mr-1">{{ title }}</span>
                            {{ /programming_languages }}
                        </div>
                        {{ /if }}
                    </div>
                </div>
            </div>

            <!-- Navigation Panel -->
            <div class="card-sharp bg-white border-2 border-black shadow-sharp transform hover:rotate-0 transition-all duration-300 reveal-on-scroll -rotate-2">
                <div class="absolute -top-2 -left-2 w-4 h-4 bg-black transform rotate-45"></div>
                
                <div class="p-6">
                    <h3 class="font-black mb-4 text-lg geometric-accent">NAVIGATE_CODE</h3>
                    
                    <div class="space-y-3">
                        <a href="/snippets" class="block w-full bg-gray-800 text-white font-mono text-sm py-3 px-4 text-center hover:bg-accent transition-colors">
                            ‚Üê ALL_SNIPPETS
                        </a>
                        
                        <a href="/snippets#language-{{ language }}" class="block w-full bg-gray-100 text-gray-800 font-mono text-sm py-3 px-4 text-center hover:bg-accent hover:text-white transition-colors">
                            MORE_{{ language | upper }}
                        </a>
                        
                        <a href="/projects" class="block w-full bg-accent text-white font-mono text-sm py-3 px-4 text-center hover:bg-black transition-colors">
                            VIEW_PROJECTS
                        </a>
                    </div>
                </div>
            </div>

            <!-- Related Snippets -->
            {{ assign related_snippets = collection:code_snippets language:is=language limit="3" id:not=id }}
            {{ if related_snippets | count > 0 }}
            <div class="card-sharp bg-black border-2 border-accent text-white shadow-sharp transform hover:rotate-0 transition-all duration-300 reveal-on-scroll rotate-1">
                <div class="p-6 font-mono">
                    <h3 class="text-accent font-black mb-4 text-lg">RELATED_{{ language | upper }}</h3>
                    
                    <div class="space-y-3">
                        {{ related_snippets }}
                        <a href="{{ url }}" class="block border border-gray-600 p-3 hover:border-accent transition-colors">
                            <div class="text-green-400 text-sm font-bold mb-1">{{ title | truncate:30 }}</div>
                            <div class="text-gray-400 text-xs">{{ difficulty | upper }} ‚Ä¢ {{ date format="M Y" }}</div>
                        </a>
                        {{ /related_snippets }}
                    </div>
                </div>
            </div>
            {{ /if }}

            <!-- Action Panel -->
            <div class="card-sharp bg-accent text-white shadow-sharp transform hover:rotate-0 transition-all duration-300 reveal-on-scroll -rotate-1">
                <div class="absolute -top-3 -right-3 w-6 h-6 bg-white transform rotate-45"></div>
                
                <div class="p-6 text-center">
                    <h3 class="font-black mb-4 text-lg">DEPLOY_CODE?</h3>
                    <p class="mb-6 text-sm opacity-90">Found this snippet useful?<br>Let's collaborate on something amazing!</p>
                    
                    <div class="space-y-3">
                        <a href="/contact" class="block w-full bg-white text-accent font-black py-3 px-4 text-center hover:bg-black hover:text-white transition-colors">
                            CONTACT_DEV
                        </a>
                        
                        <a href="https://github.com" target="_blank" class="block w-full bg-black text-white font-mono text-sm py-3 px-4 text-center hover:bg-white hover:text-black transition-colors">
                            FORK_ON_GITHUB
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Terminal Footer -->
    <footer class="text-center mb-16 reveal-on-scroll">
        <div class="bg-black border-4 border-accent p-8 shadow-sharp transform rotate-1 font-mono">
            <div class="absolute -top-3 -left-3 w-6 h-6 bg-accent transform rotate-45"></div>
            <div class="absolute -bottom-3 -right-3 w-8 h-8 border-2 border-white transform rotate-45"></div>
            
            <div class="text-green-400 mb-4">
                <span class="text-accent">$</span> git commit -m "Successfully analyzed {{ title | slugify }}.{{ language }}"
            </div>
            <div class="text-gray-400 mb-4">
                [{{ slug }}] Commit successful ‚Ä¢ Ready for deployment
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="/snippets" class="radical-button bg-accent text-white px-6 py-3 font-black uppercase tracking-wider border-2 border-accent hover:bg-white hover:text-accent transition-all duration-300 transform hover:scale-105 shadow-sharp">
                    EXPLORE_MORE
                </a>
                <a href="/contact" class="radical-button bg-white text-black px-6 py-3 font-black uppercase tracking-wider border-2 border-white hover:bg-accent hover:text-white transition-all duration-300 transform hover:scale-105 shadow-sharp">
                    HIRE_DEV
                </a>
            </div>
        </div>
    </footer>
</div>

<!-- Enhanced JavaScript for code interactions -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Copy code functionality
        const copyButton = document.getElementById('copy-code');
        const codeContent = document.getElementById('code-content');
        
        if (copyButton && codeContent) {
            copyButton.addEventListener('click', async () => {
                try {
                    const codeText = codeContent.textContent;
                    await navigator.clipboard.writeText(codeText);
                    
                    // Visual feedback
                    copyButton.textContent = '[COPIED!]';
                    copyButton.classList.add('text-green-400');
                    
                    setTimeout(() => {
                        copyButton.textContent = '[COPY]';
                        copyButton.classList.remove('text-green-400');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy code:', err);
                    copyButton.textContent = '[ERROR]';
                    setTimeout(() => {
                        copyButton.textContent = '[COPY]';
                    }, 2000);
                }
            });
        }

        // Initialize reveal on scroll animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('revealed');
                }
            });
        }, observerOptions);

        // Observe all reveal elements
        document.querySelectorAll('.reveal-on-scroll').forEach(el => {
            observer.observe(el);
        });

        // Enhanced parallax effect for background elements
        let ticking = false;
        
        function updateParallax() {
            const scrolled = window.pageYOffset;
            const parallaxElements = document.querySelectorAll('.bg-element');

            parallaxElements.forEach((element, index) => {
                const speed = 0.05 + (index * 0.02);
                const yPos = -(scrolled * speed);
                const rotation = 45 + (scrolled * 0.05) + (index * 10);
                element.style.transform = `translateY(${yPos}px) rotate(${rotation}deg)`;
            });
            
            ticking = false;
        }

        window.addEventListener('scroll', () => {
            if (!ticking) {
                requestAnimationFrame(updateParallax);
                ticking = true;
            }
        });

        // Terminal loading animation
        const terminalWindows = document.querySelectorAll('.terminal-window');
        terminalWindows.forEach((terminal, index) => {
            terminal.style.opacity = '0';
            terminal.style.transform = 'translateY(20px) rotate(-1deg)';
            
            setTimeout(() => {
                terminal.style.transition = 'all 0.8s ease';
                terminal.style.opacity = '1';
                terminal.style.transform = 'rotate(-1deg)';
            }, 200 + (index * 100));
        });

        // Magnetic effect for buttons
        document.querySelectorAll('.radical-button').forEach(button => {
            button.addEventListener('mousemove', (e) => {
                const rect = button.getBoundingClientRect();
                const x = ((e.clientX - rect.left) - rect.width / 2) * 0.1;
                const y = ((e.clientY - rect.top) - rect.height / 2) * 0.1;

                button.style.setProperty('--mouse-x', `${x}px`);
                button.style.setProperty('--mouse-y', `${y}px`);
                button.style.transform = `translate(var(--mouse-x, 0), var(--mouse-y, 0)) scale(1.05)`;
            });

            button.addEventListener('mouseleave', () => {
                button.style.setProperty('--mouse-x', '0px');
                button.style.setProperty('--mouse-y', '0px');
                button.style.transform = 'translate(0, 0) scale(1)';
            });
        });

        // Code syntax highlighting simulation
        function enhanceCodeDisplay() {
            const codeElement = document.getElementById('code-content');
            if (codeElement) {
                // Add line numbers
                const lines = codeElement.textContent.split('\n');
                let numberedCode = '';
                
                lines.forEach((line, index) => {
                    if (line.trim() !== '' || index < lines.length - 1) {
                        const lineNumber = String(index + 1).padStart(3, ' ');
                        numberedCode += `<span class="text-gray-500 select-none">${lineNumber} ‚îÇ </span>${line}\n`;
                    }
                });
                
                codeElement.innerHTML = numberedCode;
            }
        }

        enhanceCodeDisplay();

        // Progress indicator for long code
        function addProgressIndicator() {
            const codeContainer = codeContent.parentElement;
            const scrollHeight = codeContent.scrollHeight;
            const containerHeight = codeContainer.clientHeight;
            
            if (scrollHeight > containerHeight) {
                const progressBar = document.createElement('div');
                progressBar.className = 'absolute bottom-0 left-0 h-1 bg-accent transition-all duration-200';
                progressBar.style.width = '0%';
                codeContainer.appendChild(progressBar);
                
                codeContainer.addEventListener('scroll', () => {
                    const scrolled = codeContainer.scrollTop;
                    const maxScroll = scrollHeight - containerHeight;
                    const progress = (scrolled / maxScroll) * 100;
                    progressBar.style.width = `${Math.min(progress, 100)}%`;
                });
            }
        }

        addProgressIndicator();
    });
</script>

<!-- Additional CSS for custom animations -->
<style>
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(45deg); }
        50% { transform: translateY(-10px) rotate(50deg); }
    }
    
    @keyframes float-delayed {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-15px) rotate(5deg); }
    }
    
    @keyframes spin-slow {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .animate-float {
        animation: float 4s ease-in-out infinite;
    }
    
    .animate-float-delayed {
        animation: float-delayed 5s ease-in-out infinite;
        animation-delay: 1s;
    }
    
    .animate-spin-slow {
        animation: spin-slow 20s linear infinite;
    }
    
    /* Enhanced glitch effect */
    .glitch-effect {
        position: relative;
        animation: glitch 3s infinite;
    }
    
    @keyframes glitch {
        0%, 90%, 100% {
            transform: translate(0);
        }
        20% {
            transform: translate(-1px, 1px);
        }
        40% {
            transform: translate(-1px, -1px);
        }
        60% {
            transform: translate(1px, 1px);
        }
        80% {
            transform: translate(1px, -1px);
        }
    }
    
    /* Reveal animation */
    .reveal-on-scroll {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease, transform 0.8s ease;
    }
    
    .reveal-on-scroll.revealed {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* Code container scrollbar styling */
    #code-content::-webkit-scrollbar {
        height: 8px;
        width: 8px;
    }
    
    #code-content::-webkit-scrollbar-track {
        background: #1f2937;
    }
    
    #code-content::-webkit-scrollbar-thumb {
        background: #10b981;
        border-radius: 4px;
    }
    
    #code-content::-webkit-scrollbar-thumb:hover {
        background: #059669;
    }
</style>