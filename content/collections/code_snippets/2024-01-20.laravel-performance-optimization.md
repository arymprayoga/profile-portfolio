---
id: 8f2a1b5c-3d4e-4f5a-8b6c-1a2b3c4d5e6f
blueprint: code_snippet
title: 'Laravel Performance Optimization Helper'
description: 'A utility class for common Laravel performance optimizations including query optimization, caching strategies, and memory management.'
language: php
programming_languages:
  - php
difficulty: intermediate
use_cases:
  - performance-optimization
  - laravel-development
  - backend-optimization
is_featured: true
external_link: null
status: published
date: 1705737600
---

```php
<?php

namespace App\Utils;

use Illuminate\Support\Facades\Cache;
use Illuminate\Support\Facades\DB;
use Illuminate\Database\Eloquent\Builder;

class PerformanceOptimizer
{
    /**
     * Optimize a query by adding eager loading relationships
     */
    public static function eagerLoad(Builder $query, array $relationships): Builder
    {
        return $query->with($relationships);
    }

    /**
     * Cache expensive query results
     */
    public static function cacheQuery(string $key, callable $callback, int $minutes = 60)
    {
        return Cache::remember($key, $minutes * 60, $callback);
    }

    /**
     * Chunk large dataset processing to avoid memory issues
     */
    public static function processInChunks(Builder $query, callable $callback, int $chunkSize = 1000): void
    {
        $query->chunk($chunkSize, $callback);
    }

    /**
     * Get database query count for debugging
     */
    public static function getQueryCount(): int
    {
        return count(DB::getQueryLog());
    }

    /**
     * Memory usage helper
     */
    public static function getMemoryUsage(): array
    {
        return [
            'current' => memory_get_usage(true),
            'peak' => memory_get_peak_usage(true),
            'formatted_current' => self::formatBytes(memory_get_usage(true)),
            'formatted_peak' => self::formatBytes(memory_get_peak_usage(true))
        ];
    }

    private static function formatBytes(int $size, int $precision = 2): string
    {
        $base = log($size, 1024);
        $suffixes = ['B', 'KB', 'MB', 'GB', 'TB'];
        
        return round(pow(1024, $base - floor($base)), $precision) . ' ' . $suffixes[floor($base)];
    }
}

// Usage Examples:

// 1. Eager loading to prevent N+1 queries
$users = PerformanceOptimizer::eagerLoad(
    User::query(), 
    ['posts', 'comments', 'profile']
)->get();

// 2. Caching expensive queries
$stats = PerformanceOptimizer::cacheQuery('user_stats', function() {
    return DB::table('users')
        ->selectRaw('COUNT(*) as total, AVG(age) as avg_age')
        ->first();
}, 30);

// 3. Processing large datasets in chunks
PerformanceOptimizer::processInChunks(
    User::query(),
    function($users) {
        foreach($users as $user) {
            // Process each user
            $user->updateSomeField();
        }
    },
    500
);

// 4. Monitor query count in development
DB::enableQueryLog();
// Your code here
$queryCount = PerformanceOptimizer::getQueryCount();
logger("Executed {$queryCount} queries");

// 5. Monitor memory usage
$memory = PerformanceOptimizer::getMemoryUsage();
logger("Memory usage: {$memory['formatted_current']} (Peak: {$memory['formatted_peak']})");
```